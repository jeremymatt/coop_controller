<!DOCTYPE html>
<html>
<head>
    <title>Coop Controller</title>
    <script>
        // Define the sendCommand function
        function sendCommand(command) {
            fetch("/update", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ command: command }),
            })
            .then(response => response.json())
            .then(data => updatePage(data))
            .catch(error => console.error("Error sending command:", error));
        }

        // Define the updatePage function to update the DOM elements
        function updatePage(data) {
            document.getElementById("door_current_state").innerText = data.door_current_state;
            document.getElementById("door_error_state").innerText = data.door_error_state;
            document.getElementById("door_auto_state").innerText = data.door_auto_state;

            document.getElementById("light_current_state").innerText = data.light_current_state;
            document.getElementById("light_auto_state").innerText = data.light_auto_state;

            document.getElementById("system_time").innerText = data.system_time;
        }

        // Regularly fetch updates every second
        function fetchUpdate() {
            sendCommand("update");
        }

        // Start the update loop
        document.addEventListener("DOMContentLoaded", () => {
            setInterval(fetchUpdate, 1000);
        });
    </script>
</head>
<body>
    <h1>COOP CONTROLLER</h1>

    <strong><u>Door</u></strong><br>
    Current state: <span id="door_current_state">Unknown</span><br>
    Error state: <span id="door_error_state">None</span><br>
    Auto-door state: <span id="door_auto_state">Disabled</span><br>
    <button style="background-color:green;" onclick="sendCommand('raise_door')">Raise</button>
    <button style="background-color:green;" onclick="sendCommand('lower_door')">Lower</button>
    <button style="background-color:red;" onclick="sendCommand('stop_door')">Stop</button>
    <button style="background-color:grey;" onclick="sendCommand('cancel_override_door')">Auto</button>

    <strong><u>Light</u></strong><br>
    Current state: <span id="light_current_state">Unknown</span><br>
    Auto-light state: <span id="light_auto_state">Disabled</span><br>
    <button style="background-color:green;" onclick="sendCommand('light_on')">On</button>
    <button style="background-color:red;" onclick="sendCommand('light_off')">Off</button>
    <button style="background-color:grey;" onclick="sendCommand('cancel_override_light')">Auto</button>

    <button style="background-color:grey;" onclick="sendCommand('clear_errors')">Clear errors</button><br>

    System time: <span id="system_time">Unknown</span><br>

    <form method="post" action="/logout">
        <button type="submit" style="background-color:orange;">Logout</button>
    </form>
</body>
</html>
